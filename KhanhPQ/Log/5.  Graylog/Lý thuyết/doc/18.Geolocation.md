# Geolocation
Graylog cho phép ta trích xuất và trực quan hóa thông tin định vị địa lý từ các địa chỉ IP trong log ta nhận được

2 cách trực quan hóa
- Thông qua các file csv -> trích xuất đẩy ra thành các trường tương ứng
- API -> view trực tiếp lên bản đồ

## 1. Download the database
Có 2 db mà ta có thể sử dụng
- GeoIP2 Databases (Mất phí) : https://www.maxmind.com/en/geoip2-databases
- GeoLite2 Databases (Miễn phí) : https://dev.maxmind.com/geoip/geoip2/geolite2/

Sẽ có các file nén tương đương với 2 cách trực quan hóa

**C1: CSV**
![Imgur](https://i.imgur.com/QKqAjnN.png)
![Imgur](https://i.imgur.com/W0uQN6r.png)

Copy các file cần thiết vào /etc/graylog/ . Có thể tạo folder nếu muốn

![Imgur](https://i.imgur.com/qOFs0sW.png)
Ở đây ta sử dụng 2 file csv là Block-IPv4 và Locations-es định dạng tiếng anh (es)


Ta thấy ở có mỗi liên quan đó là:

Ở Block-IPv4:
- ta có thể từ IP -> xuất ra được id của nước
Ở Locations-es:
- ta có thể từ id của nước -> xuất ra tên nước

Do đó ta tạo 2 lookup table với file nguồn adapter là 2 file CSV, key-value là các column tương ứng kể trên kể trên. Cache vẫn là node- local

Từ field chứa IP trên stream tạo Extractor Lookup Table tới lookup-table Block-IPv4 để xuất ra trường **id_country** (id nước của ip kia)

Tiếp theo từ field **id_country** tạo Extractor Lookup Table tới lookup-table Locations-es để xuất ra trường **country** (tên nước)

![Imgur](https://i.imgur.com/98ejWvo.png)

Kết quả mà ta nhận được sẽ có dạng như sau:

![Imgur](https://i.imgur.com/CesG9Hn.png)